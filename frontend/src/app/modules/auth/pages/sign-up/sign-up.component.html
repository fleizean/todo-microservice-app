<form [formGroup]="signUpForm" (ngSubmit)="onSubmit()" class="my-10 space-y-6">

  <!-- Success Message -->
  <div *ngIf="successMessage"
    class="mb-4 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-md text-sm">
    {{ successMessage }}
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md text-sm">
    {{ errorMessage }}
  </div>

  <div class="text-center">
    <h2 class="text-foreground mb-1 text-3xl font-semibold">Sign Up <span class="text-primary">!</span></h2>
    <p class="text-muted-foreground text-sm">Let's get started with your 30 day free trial</p>
  </div>


  <div class="space-y-3 text-left">
    <!-- Fullname Field -->
    <div class="relative">
      <input type="text" id="fullname" formControlName="fullname"
        class="peer block w-full rounded-md border border-gray-300 px-3 py-2 placeholder-transparent focus:border-primary focus:outline-none focus:ring-primary"
        placeholder=" " [class.border-red-500]="isFieldInvalid('fullname')" />
      <label for="fullname"
        class="bg-background text-muted-foreground peer-focus:text-primary absolute top-2 z-10 origin-[0] -translate-y-4 scale-95 transform px-2 text-sm duration-300 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-2 peer-focus:-translate-y-4 peer-focus:scale-95 peer-focus:px-2 ltr:left-1 rtl:right-1">
        Full Name
      </label>
      <div *ngIf="isFieldInvalid('fullname')" class="text-red-500 text-xs mt-1">
        {{ getFieldError('fullname') }}
      </div>
    </div>

    <!-- Username Field -->
    <div class="relative">
      <input type="text" id="username" formControlName="username"
        class="peer block w-full rounded-md border border-gray-300 px-3 py-2 placeholder-transparent focus:border-primary focus:outline-none focus:ring-primary"
        placeholder=" " [class.border-red-500]="isFieldInvalid('username')" />
      <label for="username"
        class="bg-background text-muted-foreground peer-focus:text-primary absolute top-2 z-10 origin-[0] -translate-y-4 scale-95 transform px-2 text-sm duration-300 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-2 peer-focus:-translate-y-4 peer-focus:scale-95 peer-focus:px-2 ltr:left-1 rtl:right-1">
        Username
      </label>
      <div *ngIf="isFieldInvalid('username')" class="text-red-500 text-xs mt-1">
        {{ getFieldError('username') }}
      </div>
    </div>

    <!-- Email Field -->
    <div class="relative">
      <input type="email" id="email" formControlName="email"
        class="peer block w-full rounded-md border border-gray-300 px-3 py-2 placeholder-transparent focus:border-primary focus:outline-none focus:ring-primary"
        placeholder=" " [class.border-red-500]="isFieldInvalid('email')" />
      <label for="email"
        class="bg-background text-muted-foreground peer-focus:text-primary absolute top-2 z-10 origin-[0] -translate-y-4 scale-95 transform px-2 text-sm duration-300 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-2 peer-focus:-translate-y-4 peer-focus:scale-95 peer-focus:px-2 ltr:left-1 rtl:right-1">
        Email address
      </label>
      <div *ngIf="isFieldInvalid('email')" class="text-red-500 text-xs mt-1">
        {{ getFieldError('email') }}
      </div>
    </div>

    <!-- Password Field -->
    <div class="relative">
      <input [type]="showPassword ? 'text' : 'password'" id="password" formControlName="password"
        class="peer block w-full rounded-md border border-gray-300 px-3 py-2 pr-10 placeholder-transparent focus:border-primary focus:outline-none focus:ring-primary"
        placeholder=" " [class.border-red-500]="isFieldInvalid('password')" />
      <label for="password"
        class="bg-background text-muted-foreground peer-focus:text-primary absolute top-2 z-10 origin-[0] -translate-y-4 scale-95 transform px-2 text-sm duration-300 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-2 peer-focus:-translate-y-4 peer-focus:scale-95 peer-focus:px-2 ltr:left-1 rtl:right-1">
        Password
      </label>
      <span class="text-muted-foreground absolute top-2 cursor-pointer ltr:right-3 rtl:left-3"
        (click)="togglePasswordVisibility()">
        <svg-icon
          [src]="showPassword ? 'assets/icons/heroicons/outline/eye.svg' : 'assets/icons/heroicons/outline/eye-off.svg'"
          [svgClass]="'h-5 w-5'">
        </svg-icon>
      </span>
      <div *ngIf="isFieldInvalid('password')" class="text-red-500 text-xs mt-1">
        {{ getFieldError('password') }}
      </div>
    </div>

    <!-- Password Strength Meter -->
    <div class="grid grid-cols-4 gap-2" *ngIf="signUpForm.get('password')?.value">
      <div *ngFor="let i of [1,2,3,4]" class="rounded-xs h-1 transition-colors"
        [class.bg-red-500]="i <= getPasswordStrength() && getPasswordStrength() <= 2"
        [class.bg-yellow-500]="i <= getPasswordStrength() && getPasswordStrength() === 3"
        [class.bg-green-500]="i <= getPasswordStrength() && getPasswordStrength() === 4"
        [class.bg-muted]="i > getPasswordStrength()"></div>
    </div>
    <span class="text-muted-foreground text-xs" *ngIf="signUpForm.get('password')?.value">
      Use 8 or more characters with a mix of letters, numbers & symbols.
    </span>

    <!-- Confirm Password Field -->
    <div class="relative">
      <input [type]="showConfirmPassword ? 'text' : 'password'" id="confirm-password" formControlName="confirmPassword"
        class="peer block w-full rounded-md border border-gray-300 px-3 py-2 pr-10 placeholder-transparent focus:border-primary focus:outline-none focus:ring-primary"
        placeholder=" "
        [class.border-red-500]="isFieldInvalid('confirmPassword') || signUpForm.hasError('passwordMismatch')" />
      <label for="confirm-password"
        class="bg-background text-muted-foreground peer-focus:text-primary absolute top-2 left-1 z-10 origin-[0] -translate-y-4 scale-95 transform px-2 text-sm duration-300 peer-placeholder-shown:top-1/2 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:scale-100 peer-focus:top-2 peer-focus:-translate-y-4 peer-focus:scale-95 peer-focus:px-2">
        Confirm Password
      </label>
      <span class="text-muted-foreground absolute top-2 cursor-pointer ltr:right-3 rtl:left-3"
        (click)="toggleConfirmPasswordVisibility()">
        <svg-icon
          [src]="showConfirmPassword ? 'assets/icons/heroicons/outline/eye.svg' : 'assets/icons/heroicons/outline/eye-off.svg'"
          [svgClass]="'h-5 w-5'">
        </svg-icon>
      </span>
      <div *ngIf="signUpForm.hasError('passwordMismatch') && signUpForm.get('confirmPassword')?.touched"
        class="text-red-500 text-xs mt-1">
        Şifreler eşleşmiyor
      </div>
      <div *ngIf="isFieldInvalid('confirmPassword')" class="text-red-500 text-xs mt-1">
        {{ getFieldError('confirmPassword') }}
      </div>
    </div>
  </div>

  <!-- Terms Checkbox -->
  <div class="my-4 border border-gray-100 rounded-md p-4 bg-gray-50">
    <div class="flex items-center">
      <div class="relative inline-flex items-center">
        <input id="accept-term" type="checkbox" formControlName="acceptTerms"
          class="peer h-5 w-5 rounded border-gray-300 text-primary focus:ring-primary focus:ring-offset-1"
          [class.border-red-500]="isFieldInvalid('acceptTerms')" />
        <div
          class="pointer-events-none absolute inset-0 rounded border-2 border-transparent peer-checked:border-primary peer-focus:border-primary">
        </div>
      </div>
      <div class="ml-3 text-sm flex flex-wrap items-center">
        <label for="accept-term" class="font-medium text-gray-700">I agree to the</label>
        <span class="flex flex-wrap items-center gap-1">
          <app-button (click)="openTermsModal()" impact="none" tone="primary" shape="rounded" size="small" type="button"
            class="font-medium underline">
            Terms of Service
          </app-button>
          <span class="text-gray-600">and</span>
          <app-button (click)="openPrivacyModal()" impact="none" tone="primary" shape="rounded" size="small"
            type="button" class="font-medium underline">
            Privacy Policy
          </app-button>
        </span>
      </div>
    </div>
    <div *ngIf="isFieldInvalid('acceptTerms')" class="mt-2 text-sm text-red-600 flex items-center">
      <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd"
          d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2h-1V9z"
          clip-rule="evenodd"></path>
      </svg>
      {{ getFieldError('acceptTerms') }}
    </div>
  </div>


  <!-- Terms Modal -->
  <div *ngIf="showTermsModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"
    (click)="onBackdropClick($event)">
    <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-hidden">
      <!-- Modal Header -->
      <div class="flex items-center justify-between p-6 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900">Terms of Service</h3>
        <button type="button" (click)="closeTermsModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <!-- Modal Content -->
      <div class="p-6 overflow-y-auto max-h-[60vh]">
        <div class="prose prose-sm max-w-none">
          <h4 class="text-base font-semibold mb-3">1. Acceptance of Terms</h4>
          <p class="mb-4 text-gray-700">
            By accessing and using Tasky, you accept and agree to be bound by the terms and provision of this agreement.
          </p>

          <h4 class="text-base font-semibold mb-3">2. Use License</h4>
          <p class="mb-4 text-gray-700">
            Permission is granted to temporarily use Tasky for personal, non-commercial transitory viewing only. This is
            the grant of a license, not a transfer of title.
          </p>

          <h4 class="text-base font-semibold mb-3">3. User Account</h4>
          <p class="mb-4 text-gray-700">
            You are responsible for safeguarding the password and for maintaining the confidentiality of your account.
          </p>

          <h4 class="text-base font-semibold mb-3">4. Prohibited Uses</h4>
          <p class="mb-4 text-gray-700">
            You may not use our service for any unlawful purpose or to solicit others to perform unlawful acts.
          </p>

          <h4 class="text-base font-semibold mb-3">5. Content</h4>
          <p class="mb-4 text-gray-700">
            Our service allows you to post, link, store, share and otherwise make available certain information, text,
            graphics, or other material.
          </p>

          <h4 class="text-base font-semibold mb-3">6. Termination</h4>
          <p class="mb-4 text-gray-700">
            We may terminate or suspend your account and bar access to the service immediately, without prior notice or
            liability.
          </p>
        </div>
      </div>

      <!-- Modal Footer -->
      <div class="flex justify-end p-6 border-t border-gray-200">
        <button type="button" (click)="closeTermsModal()"
          class="px-4 py-2 text-sm font-medium text-white bg-primary rounded-md hover:bg-primary-dark transition-colors">
          I Understand
        </button>
      </div>
    </div>
  </div>
  <!-- Privacy Policy Modal -->
  <div *ngIf="showPrivacyModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50"
    (click)="onBackdropClick($event)">
    <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-hidden">
      <!-- Modal Header -->
      <div class="flex items-center justify-between p-6 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900">Privacy Policy</h3>
        <button type="button" (click)="closePrivacyModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <!-- Modal Content -->
      <div class="p-6 overflow-y-auto max-h-[60vh]">
        <div class="prose prose-sm max-w-none">
          <h4 class="text-base font-semibold mb-3">Information We Collect</h4>
          <p class="mb-4 text-gray-700">
            We collect information you provide directly to us, such as when you create an account, use our services, or
            contact us for support.
          </p>

          <h4 class="text-base font-semibold mb-3">How We Use Your Information</h4>
          <p class="mb-4 text-gray-700">
            We use the information we collect to provide, maintain, and improve our services, process transactions, and
            communicate with you.
          </p>

          <h4 class="text-base font-semibold mb-3">Information Sharing</h4>
          <p class="mb-4 text-gray-700">
            We do not sell, trade, or otherwise transfer your personal information to third parties without your
            consent, except as described in this policy.
          </p>

          <h4 class="text-base font-semibold mb-3">Data Security</h4>
          <p class="mb-4 text-gray-700">
            We implement appropriate security measures to protect your personal information against unauthorized access,
            alteration, disclosure, or destruction.
          </p>

          <h4 class="text-base font-semibold mb-3">Cookies</h4>
          <p class="mb-4 text-gray-700">
            We use cookies and similar tracking technologies to track activity on our service and store certain
            information.
          </p>

          <h4 class="text-base font-semibold mb-3">Contact Us</h4>
          <p class="mb-4 text-gray-700">
            If you have any questions about this Privacy Policy, please contact us at privacy&#64;tasky.com.
          </p>
        </div>
      </div>

      <!-- Modal Footer -->
      <div class="flex justify-end p-6 border-t border-gray-200">
        <button type="button" (click)="closePrivacyModal()"
          class="px-4 py-2 text-sm font-medium text-white bg-primary rounded-md hover:bg-primary-dark transition-colors">
          Got It
        </button>
      </div>
    </div>
  </div>

  <!-- Submit Button -->
  <div>
    <app-button full impact="bold" tone="primary" shape="rounded" size="medium" type="submit"
      [disabled]="signUpForm.invalid || isLoading">
      {{ isLoading ? 'Signing up...' : 'Sign up' }}
    </app-button>
  </div>

  <!-- Sign-in Link -->
  <div class="text-muted-foreground flex items-center text-sm">
    Already have an Account?
    <app-button routerLink ="/auth/sign-in" impact="none" tone="primary" shape="rounded" size="small">
      Sign in
    </app-button>
  </div>
</form>